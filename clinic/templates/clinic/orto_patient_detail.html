{% extends "clinic/base.html" %}
{% block title %}{{ patient.emri_mbiemri }} – Orto{% endblock %}
{% block content %}

  <!-- Header -->
  <div class="mb-6 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <h1 class="text-lg font-semibold">Pacient (Orto): {{ patient.emri_mbiemri }}</h1>
    </div>
    <a class="px-4 py-2 bg-emerald-600 text-white rounded"
       href="{% url 'add_orto_history' patient.id %}">
      + Shto ORTO histori
    </a>
  </div>

  <!-- Info bazë -->
  <div class="mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="bg-white border rounded-lg p-4 md:col-span-2">
      <h2 class="font-semibold text-base mb-3">Të dhënat e pacientit (Orto)</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
        <div><span class="text-gray-500">Emri:</span> {{ patient.emri_mbiemri }}</div>
        <div><span class="text-gray-500">Data e lindjes:</span> {{ patient.data_e_lindjes }}</div>
        <div><span class="text-gray-500">Telefoni:</span> {{ patient.telefoni }}</div>
        <div><span class="text-gray-500">Email:</span> {{ patient.emaili }}</div>
        <div class="md:col-span-2"><span class="text-gray-500">Adresa:</span> {{ patient.adresa }}</div>
      </div>
    </div>

    <div class="bg-white border rounded-lg p-4">
      <h2 class="font-semibold text-base mb-3">Përmbledhje</h2>
      <div class="text-sm space-y-1">
        <!-- Nëse keni related_name ndryshe, ndryshoni rreshtin poshtë -->
        <div>Nr. ORTO historive:
          <b>{{ patient.historyortodentics_set.all|length }}</b>
        </div>
      </div>
    </div>
  </div>

  <!-- Historitë ORTO -->
  <div class="bg-white border rounded-lg p-4 overflow-x-auto">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold text-base">Historitë ORTO</h2>
      <a class="px-3 py-1.5 text-sm bg-emerald-600 text-white rounded"
         href="{% url 'add_orto_history' patient.id %}">
        + Shto ORTO histori
      </a>
    </div>

    <table class="w-full text-sm">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">Data</th>
          <th class="p-2 text-left">Diagnoza</th>
          <th class="p-2 text-left">Trajtimi</th>
          <th class="p-2 text-left">Vlera</th>
          <th class="p-2 text-left">Paguar</th>
          <th class="p-2 text-left">Borgji</th>
          <th class="p-2 text-left">Doktori</th>
          <th class="p-2 text-left">Vërejtje</th>
        </tr>
      </thead>
      <tbody>
        {% for h in patient.ortho_histories.all %}
        <tr class="border-t">
          <td class="p-2">{{ h.data }}</td>
          <td class="p-2">{{ h.diagnoza }}</td>
          <td class="p-2">{{ h.trajtimi }}</td>
          <td class="p-2">{{ h.vlera }}</td>
          <td class="p-2">{{ h.paguar }}</td>
          <td class="p-2">{{ h.borgji }}</td>
          <td class="p-2">{{ h.doctor }}</td>
          <td class="p-2">{{ h.verejtje }}</td>
        </tr>
        {% empty %}
        <tr><td class="p-3" colspan="8">Nuk ka histori ortodontike.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

{% endblock %}
